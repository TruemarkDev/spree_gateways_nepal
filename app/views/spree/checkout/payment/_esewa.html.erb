
 <a id="payment-button-esewa" href="#"><%= Spree.t(:pay_with_esewa) %></a>
<script>
  window.addEventListener('DOMContentLoaded', function () {
    SpreeGatewaysNepal.paymentMethodID = "<%= payment_method.id %>"
  })

  var btn = document.getElementById("payment-button-esewa");
  btn.onclick = function (e) {
    var path="https://uat.esewa.com.np/epay/main";
    var params= {
        amt: "<%= @order.item_total%>",
        psc: "<%= @order.shipment_total%>",
        pdc: 0,
        txAmt: "<%= @order.additional_tax_total%>",
        tAmt: "<%= @order.total%>",
        pid: "<%= @order.number%>",
        scd: "<%= payment_method.preferences[:merchant_code]%>",
        su: "http://localhost:3000/checkout",
        fu: "http://localhost:3000/checkout"
    }

    function post(path, params) {
        var form = document.createElement("form");
        form.setAttribute("method", "POST");
        form.setAttribute("action", path);

        for(var key in params) {
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", key);
            hiddenField.setAttribute("value", params[key]);
            form.appendChild(hiddenField);
        }

        document.body.appendChild(form);
        form.submit();
    }

    post(path, params);
  }

</script>

